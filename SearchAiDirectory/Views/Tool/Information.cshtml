@model Tool
@{
    Layout = "_LayoutHome";
    IList<Category> categories = ViewBag.Categories as IList<Category>;
}

<!-- HEADER -->
<header class="bg-dark pt-9 pb-11 d-none d-md-block">
    <div class="container-md">
        <div class="row align-items-center">
            <div class="col">

                <!-- Heading -->
                <h1 class="fw-bold text-white mb-2">
                    Business Verification
                </h1>

                <!-- Text -->
                <p class="fs-lg text-white-75 mb-0">
                    Information for @Model.Name
                </p>

            </div>
            <div class="col-auto">
                <a href="/Listing/Tool/@Model.ID" class="btn btn-sm btn-gray-300-20">
                    Preview
                </a>
            </div>
        </div> <!-- / .row -->
    </div> <!-- / .container -->
</header>

<!-- MAIN -->
<main class="pb-8 pb-md-11 mt-md-n6">
    <div class="container-md">
        <div class="row">
            <div class="col-12 col-md-3">
                <!-- Card -->
                <div class="card card-bleed border-bottom border-bottom-md-0 shadow-light-lg">

                    <!-- Collapse -->
                    <div class="collapse d-md-block" id="sidenavCollapse">
                        <div class="card-body">

                            <!-- Heading -->
                            <h6 class="fw-bold text-uppercase mb-3">
                                Business
                            </h6>

                            <!-- List -->
                            <ul class="nav nav-pills mb-6" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                                <li class="nav-item active">
                                    <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">
                                        Information
                                    </button>
                                </li>
                                <li class="nav-item">
                                    <button class="nav-link" id="v-pills-categories-tab" data-bs-toggle="pill" data-bs-target="#v-pills-categories" type="button" role="tab" aria-controls="v-pills-categories" aria-selected="false">
                                        Categories
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-9">

                <!-- Card -->
                <div class="card card-bleed shadow-light-lg mb-6">
                    <div class="tab-content" id="v-pills-tabContent">
                        <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab" tabindex="0">
                            <div class="card-header">

                                <!-- Heading -->
                                <h4 class="mb-0">
                                    General Information
                                </h4>

                            </div>
                            <div class="card-body">
                                <form method="post" action="/Listing/UpdateInformation">
                                    <input type="hidden" id="ID" name="ID" value="@Model.ID" />
                                    <input type="hidden" id="IsConfirmed" name="IsConfirmed" value="true" />
                                    <div class="row align-items-center mb-5">
                                        <div class="col-auto">

                                            <!-- Avatar -->
                                            <div class="avatar avatar-xl">
                                                <img class="avatar-img rounded" src="~/img/avatars/projects/project-1.jpg" alt="@Model.Name" />
                                            </div>

                                        </div>
                                        <div class="col ms-n5">

                                            <!-- Heading -->
                                            <p class="mb-0">
                                                Business Logo
                                            </p>

                                            <!-- Text -->
                                            <small class="text-gray-700">
                                                PNG or JPG no larger than 1000px
                                            </small>


                                        </div>
                                        <div class="col-12 col-md-auto">

                                            <!-- Button -->
                                            <button class="btn btn-xs w-100 btn-primary mt-5 mt-md-0">
                                                Upload
                                            </button>

                                        </div>
                                    </div>
                                    <div class="row mb-5">
                                        <div class="col-12">

                                            <div class="form-group">
                                                <label class="form-label" for="Name">Name</label>
                                                <input class="form-control" id="Name" name="Name" type="text" value="@Model.Name" placeholder="Business name">
                                            </div>

                                        </div>
                                        <div class="col-12 col-md-6">

                                            <div class="form-group">
                                                <label class="form-label" for="Website">Website</label>
                                                <input class="form-control" id="Website" name="Website" type="text" value="@Model.Website" placeholder="Business website">
                                            </div>

                                        </div>
                                        <div class="col-12 col-md-6">

                                            <div class="form-group">
                                                <label class="form-label" for="Phone">Phone</label>
                                                <input class="form-control" id="Phone" name="Phone" type="text" value="@Model.Phone" placeholder="Business phone">
                                            </div>

                                        </div>
                                        <div class="col-12">

                                            <div class="form-group">
                                                <label class="form-label">Description</label>
                                                <textarea class="form-control" id="Description" name="Description" placeholder="Business description">@Model.Description</textarea>
                                            </div>

                                        </div>
                                    </div>
                                    <div class="row mb-5">
                                        <div class="col-12 col-md-auto">

                                            <!-- Button -->
                                            <button class="btn w-100 btn-primary" type="submit">
                                                Save changes
                                            </button>

                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="v-pills-categories" role="tabpanel" aria-labelledby="v-pills-categories-tab" tabindex="2">
                            <div class="card-header">

                                <!-- Heading -->
                                <h4 class="mb-0">
                                    Tool Categories
                                </h4>

                            </div>
                            <div class="card-body">
                                <!-- Form -->
                                <div class="row mb-5">
                                    @foreach (var category in categories)
                                    {
                                        <div class="col-5 bg-primary rounded rounded-3 py-3 m-3">
                                            <div class="form-check form-check-dark form-switch">
                                                <input type="checkbox" class="form-check-input" id="customSwitch_@category.ID" onclick="updateCategory(@category.ID,'@category.Name');" @(category.ID == Model.CategoryID ? "checked" : "")>
                                                <label class="form-check-label text-white" for="customSwitch_@category.ID">@category.Name</label>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Text -->
                <p class="text-center mb-0">
                    <small class="text-muted">If you no longer want to be listed, you can</small>
                    <button type="button" class="btn btn-sm btn-link text-danger text-sm-start ms-0 ps-0" data-bs-toggle="modal" data-bs-target="#modalDelete">
                        delete your business.
                    </button>
                </p>
            </div>
        </div>
    </div>
</main>

<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="categoryToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header bg-primary">
            <strong class="me-auto text-white">Category</strong>
            <small class="text-white">Updated</small>
            <button type="button" class="btn-close text-white" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div id="toastBody" class="toast-body">
        </div>
    </div>
</div>

<div class="modal fade" id="modalDelete" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title h3 fw-bold">Are you sure you want to delete this business?</h3>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Deleting a business from GetDigitalContent directory can have a significant impact on its visibility and potential customer reach. Are you sure you want to proceed with this action? We encourage you to consider editing or updating the information instead. If you still wish to delete the business, please click "Confirm" below.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <a class="btn btn-danger" href="/Listing/DeleteBusiness?listingBusinessID=@Model.ID">Confirm</a>
            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" lang="en">
        function updateCategory(listingCategoryID, listingCategoryName) {
            var listingBusinessID = @Model.ID;
            var value = document.getElementById("customSwitch_" + listingCategoryID).checked;
            var valueText = (value == true) ? 'added!' : 'removed!'
            $.ajax({
                type: 'Post',
                cache: false,
                async: false,
                url: "/Listing/UpdateCategory",
                data: { listingBusinessID: listingBusinessID, listingCategoryID: listingCategoryID },
                success: function (result) {
                    document.getElementById("toastBody").innerHTML = listingCategoryName + ' was ' + valueText;
                    const categoryToast = document.getElementById('categoryToast');
                    const toast = new bootstrap.Toast(categoryToast);
                    toast.show();
                }
            });
        }
    </script>
}